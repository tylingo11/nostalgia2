local config = {
	["crocodile"] = {count = 200, storage = 1001, start = 1, plural = "crocodiles"},
	
	["dwarf"] = {count = 400, storage = 1002, start = 1, plural = "dwarves"},
	["dwarf soldier"] = {count = 400, storage = 1002, start = 1, plural = "dwarves"},
	
	["ghoul"] = {count = 600, storage = 1003, start = 1, plural = "ghouls"},
	["goblin"] = {count = 150, storage = 1004, start = 1, plural = "goblins"},
	["larva"] = {count = 300, storage = 1005, start = 1, plural = "larva"},
	
	["minotaur"] = {count = 500, storage = 1006, start = 1, plural = "minotaurs all kind"},
	["minotaur guard"] = {count = 500, storage = 1006, start = 1, plural = "minotaurs all kind"},
	["minotaur mage"] = {count = 500, storage = 1006, start = 1, plural = "minotaurs all kind"},
	["minotaur archer"] = {count = 500, storage = 1006, start = 1, plural = "minotaurs all kind"},
	
	["rotworm"] = {count = 300, storage = 1007, start = 1, plural = "rotworms"},
	
	["orc"] = {count = 400, storage = 1008, start = 1, plural = "orcs all kind"},
	["orc shaman"] = {count = 400, storage = 1008, start = 1, plural = "orcs all kind"},
	["orc spearman"] = {count = 400, storage = 1008, start = 1, plural = "orcs all kind"},
	["orc rider"] = {count = 400, storage = 1008, start = 1, plural = "orcs all kind"},
	["orc warlord"] = {count = 400, storage = 1008, start = 1, plural = "orcs all kind"},
	["orc leader"] = {count = 400, storage = 1008, start = 1, plural = "orcs all kind"},
	["orc berserker"] = {count = 400, storage = 1008, start = 1, plural = "orcs all kind"},
	["orc warrior"] = {count = 400, storage = 1008, start = 1, plural = "orcs all kind"},
	
	--["panda"] = {count = 150, storage = 1009, start = 1, plural = "pandas"},
	
	["scarab"] = {count = 500, storage = 1010, start = 1, plural = "scarabs"},
	
	
	["tarantula"] = {count = 300, storage = 1011, start = 1, plural = "tarantulas"},
	
	["troll"] = {count = 100, storage = 1012, start = 1, plural = "trolls"},
	
	["ancient scarab"] = {count = 500, storage = 1013, start = 1, plural = "ancient scarabs"},
	
	["kongra"] = {count = 500, storage = 1014, start = 1, plural = "apes"},
	["merlkin"] = {count = 500, storage = 1014, start = 1, plural = "apes"},
	["sibang"] = {count = 500, storage = 1014, start = 1, plural = "apes"},

	["black knight"] = {count = 100, storage = 1015, start = 1, plural = "black knight"},
	
	["cyclops"] = {count = 500, storage = 1016, start = 1, plural = "cyclopses"},
	
	["demon skeleton"] = {count = 400, storage = 1017, start = 1, plural = "demon skeleton"},
	
	["dragon"] = {count = 1000, storage = 1018, start = 1, plural = "dragons"},
	
	["dwarf guard"] = {count = 700, storage = 1019, start = 1, plural = "dwarf guards"},
	
	["fire elemental"] = {count = 70, storage = 1020, start = 1, plural = "fire elementals"},
	
	["giant spider"] = {count = 500, storage = 1021, start = 1, plural = "giant spiders"},
	
	["hero"] = {count = 400, storage = 1022, start = 1, plural = "heroes"},
	
	["lizard sentinel"] = {count = 500, storage = 1023, start = 1, plural = "lizards"},
	["lizard snakecharmer"] = {count = 500, storage = 1023, start = 1, plural = "lizards"},
	["lizard templar"] = {count = 500, storage = 1023, start = 1, plural = "lizards"},
	
	["necromancer"] = {count = 500, storage = 1024, start = 1, plural = "necromancers"},
	
	--["terror bird"] = {count = 150, storage = 1025, start = 1, plural = "terror birds"},
	
	["vampire"] = {count = 500, storage = 1026, start = 1, plural = "vampires"},
	
	["behemoth"] = {count = 300, storage = 1027, start = 1, plural = "behemoth"},
	
	["dragon lord"] = {count = 1000, storage = 1028, start = 1, plural = "dragon lords"},
	
	["demon"] = {count = 666, storage = 1029, start = 1, plural = "demons"},
	
	["hydra"] = {count = 500, storage = 1030, start = 1, plural = "hydras"},
	
	["serpent spawn"] = {count = 500, storage = 1031, start = 1, plural = "serpent spawns"},
	
	["warlock"] = {count = 600, storage = 1032, start = 1, plural = "warlocks"},
	
	["swamp troll"] = {count = 100, storage = 1033, start = 1, plural = "swamp trolls"},
	["bug"] = {count = 100, storage = 1034, start = 1, plural = "bugs"},
	["hyaena"] = {count = 150, storage = 1035, start = 1, plural = "hyaenas"},
	["frost troll"] = {count = 250, storage = 1036, start = 1, plural = "frost troll"},
	["wasp"] = {count = 250, storage = 1037, start = 1, plural = "wasps"},
	["stone golem"] = {count = 200, storage = 1038, start = 1, plural = "stone golem"},
	["poison spider"] = {count = 400, storage = 1039, start = 1, plural = "poison spider"},
	["witch"] = {count = 50, storage = 1040, start = 1, plural = "witch"},
	["skeleton"] = {count = 400, storage = 1041, start = 1, plural = "skeleton"},
	["elf scout"] = {count = 400, storage = 1042, start = 1, plural = "elven scouts"},
	["ghost"] = {count = 300, storage = 1043, start = 1, plural = "ghost"},
	["scorpion"] = {count = 200, storage = 1044, start = 1, plural = "scorpion"},
	["cave rat"] = {count = 200, storage = 1045, start = 1, plural = "cave rats"},
	["snake"] = {count = 200, storage = 1046, start = 1, plural = "snakes"},
	["lion"] = {count = 200, storage = 1047, start = 1, plural = "lions"},
	["amazon"] = {count = 200, storage = 1048, start = 1, plural = "amazon"},
	["valkyrie"] = {count = 200, storage = 1049, start = 1, plural = "valkyrie"},
	["beholder"] = {count = 200, storage = 1051, start = 1, plural = "beholders"},
	["crypt shambler"] = {count = 300, storage = 1052, start = 1, plural = "crypt shamblers"},
	["mummy"] = {count = 150, storage = 1053, start = 1, plural = "mummies"},
	["rat"] = {count = 100, storage = 1054, start = 1, plural = "rats"},
}

function onKill(player, target, lasthit)
	local monster = config[target:getName():lower()]
	if not monster or not lasthit or target:getMaster() then
		return true
	end

-- START PARTY STUFF     
    local party = player:getParty()
    local membersList = {}  
    
    if party then
        membersList = party:getMembers()        -- Insert Members      
        table.insert(membersList, party:getLeader())-- Insert Leader
	else
		local storageValue = player:getStorageValue(monster.storage) 
		if storageValue >= monster.start and not player:getParty() then
			if storageValue >= monster.count then
				player:sendTextMessage(MESSAGE_STATUS_CONSOLE_BLUE, "You have already killed " .. monster.count .. " " .. monster.plural .. ". Report back to Grizzly Adams in any city depot.")
			else
				player:setStorageValue(monster.storage, storageValue + 1)
				player:sendTextMessage(MESSAGE_STATUS_CONSOLE_BLUE, "You have killed [" .. storageValue .. "/" .. monster.count .. "] " .. monster.plural .. ".")
			end
		end
    end

		local playerPos = player:getPosition()
		local affectedList = {}
        for _, partyMember in ipairs(membersList) do
            if partyMember:getPosition():getDistance(playerPos) <= 12 and party:isSharedExperienceEnabled() then
                table.insert(affectedList, partyMember)
            end
        end     

        --Party Counting
        for _, membersList in ipairs(affectedList) do
		local partyStr = membersList:getStorageValue(monster.storage)
		if partyStr >= monster.start then
            if party:isSharedExperienceEnabled() and partyStr >= monster.count then
				membersList:sendTextMessage(MESSAGE_STATUS_CONSOLE_ORANGE, 'You have already killed ['..monster.count..'/' .. monster.plural .. ']. Report back to Grizzly Adams in any city depot.')	
			else 
				membersList:setStorageValue(monster.storage, partyStr + 1)   
				membersList:sendTextMessage(MESSAGE_STATUS_CONSOLE_BLUE, "You have killed [" .. partyStr .. "/" .. monster.count .. "] " .. monster.plural .. ".")
            end      
        end
    end       
--//END PARTY STUFF//
	return true
end
